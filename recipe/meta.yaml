{% set pytest_args = "-m \"not (external or samples)\" -k \"not (multi_language or old_habibi or pdfa or iss1710 or escapedcode_followed_by_int or ASurveyofImageClassificationBasedTechniques or image_similarity)\" --cov-fail-under=82" %}
{% set pytest_args = "-m \"not (external or samples)\" -k \"not (multi_language or old_habibi or pdfa or iss1710 or escapedcode_followed_by_int or ASurveyofImageClassificationBasedTechniques or image_similarity)\" --cov-fail-under=82" %}
{% set version = "3.15.3" %}
{% set pytest_args = '-m "not (external or samples)" -k "not (multi_language or old_habibi or pdfa or iss1710 or escapedcode_followed_by_int or ASurveyofImageClassificationBasedTechniques or image_similarity)" --cov-fail-under=82' %}

package:
  name: pypdf-split
  version: {{ version }}

source:
  - folder: dist
    url: https://pypi.io/packages/source/p/pypdf/pypdf-{{ version }}.tar.gz
    sha256: 4466055bf979686b3328f4776208b264431ae4ef724f18ef832c9795a7bbe945
  - folder: src
    url: https://github.com/py-pdf/pypdf/archive/refs/tags/{{ version }}.tar.gz
    sha256: 9870667f855071082e5037911b824130891d9a686280f5aa05ca71b846d6787e

build:
  number: 0
  noarch: python

requirements:
  host:
    - python >=3.6
  run:
    - python >=3.6

outputs:

  - name: pypdf
    build:
      script: cd dist && {{ PYTHON }} -m pip install . -vv --no-deps
      noarch: python
    requirements:
      host:
        - flit-core >=3.2,<4
        - pip
        - python >=3.6
      run:
        - dataclasses
        - python >=3.6
        - typing_extensions >=3.10.0.0
    test: &simple-test
      imports:
        - pypdf
      commands:
        - pip check
      requires:
        - pip

  - name: pypdf-with-crypto
    build: &noarch-python
      noarch: python
    requirements:
      host:
        - python >=3.7
      run:
        - {{ pin_subpackage("pypdf", max_pin="x.x.x") }}
        - cryptography
        - python >=3.7
    test: *simple-test

  - name: pypdf-with-image
    build: *noarch-python
    requirements:
      host:
        - python >=3.6
      run:
        - {{ pin_subpackage("pypdf", max_pin="x.x.x") }}
        - pillow
        - python >=3.6
    test: *simple-test

  - name: pypdf-with-full
    build: *noarch-python
    requirements:
      host:
        - python >=3.6
      run:
        - {{ pin_subpackage("pypdf-with-crypto", max_pin="x.x.x") }}
        - {{ pin_subpackage("pypdf-with-image", max_pin="x.x.x") }}
        - {{ pin_subpackage("pypdf", max_pin="x.x.x") }}
        - python >=3.6
    test: *simple-test

  - name: _pypdf-with-full-tests
    build: *noarch-python
    requirements:
      host:
        - python >=3.6
      run:
        - {{ pin_subpackage("pypdf-with-crypto", max_pin="x.x.x") }}
        - {{ pin_subpackage("pypdf-with-full", max_pin="x.x.x") }}
        - {{ pin_subpackage("pypdf-with-image", max_pin="x.x.x") }}
        - {{ pin_subpackage("pypdf", max_pin="x.x.x") }}
        - python >=3.6
    test:
      source_files:
        - src/pyproject.toml
        - src/tests
        - src/resources
      imports:
        - pypdf
      commands:
        - pip check
        - cd src && pytest -vv --cov=pypdf --cov-branch --cov-report=term-missing:skip-covered --no-cov-on-fail {{ pytest_args }}
      requires:
        - pip
        - pytest-cov
        - pytest-socket
        - pytest-timeout

about:
  home: https://pypi.org/project/pypdf
  summary: A pure-python PDF library capable of splitting, merging, cropping, and transforming PDF files
  license: BSD-3-Clause
  license_file: dist/LICENSE
  dev_url: https://github.com/py-pdf/pypdf
  doc_url: https://pypdf.readthedocs.io

extra:
  feedstock-name: pypdf
  recipe-maintainers:
    - MartinThoma
    - bollwyvl
